# WAL 压缩
## Benchmark 配置
```
设备=10w
每个设备的序列=10
客户端数=50
存储组数=5
文本长度=100
时间序列编码默认
BatchPerWrite=1
DevicePerWrite=1000
```

## IoTDB 配置
```
分支：wal-compress
94261ccd1377a10f19610ddc55e7f342dee04099

WAL 与 Data Dir 都使用同一个 HDD
memory_proportion=10:1:5:1:1:1
关闭合并
primitive_array_size=4
enable_last_cache=false
```

## 结果
| | 吞吐 |  平均延迟 |P25 延迟| 中位数延迟 | P75 延迟 | P99 延迟 | 最大延迟 | 服务器延迟 | 网络流量 | 磁盘利用率 | 磁盘吞吐 |CPU 利用率|GC 百分比|
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
|未压缩|1696206|297.00|159.82 | 176.33|305.74|1273.93|14481.03| 103 ms| 68.8 MiB/s| 93.2% |129 MB/s|44.4%|10.9%|
|压缩 | 2453969 | 203.83 | 153.32 | 169.89 |190.94| 502.55 | 8053.27|25.5 ms|99.5 MiB/s|	66.3%|74.8 MB|55.3%|12.4%|
| 压缩+RPC（Gzip）|3308927 | 165.48|79.73|101.11|146.82|915.74|6861.79|102 ms|	3.06 MiB/s|81.7%|91.1 MB/s|65.5%|10.4%|
｜ 批量化写入 | 1703651 | 295.73 | 153.25 | 175.00 | 306.99| 1237.56|12481.90|95.1 ms | 69.1 MB/s | 92.3% | 130 MB/s | 40.1% |10.5%|

对比baseline 和 WALCompression + Batch 插入
http://192.168.130.31:3000/d/ZRfEph04y/apache-iotdb-performance-overview-dashboard?orgId=1&var-cluster=simulateWorkload&var-nodeType=DATANODE&var-instance=All&from=1711788032423&to=1711789866807
RPC 压缩
http://192.168.130.31:3000/d/AXEPYc-Va/apache-iotdb-system-dashboard?orgId=1&var-cluster=simulateWorkload&var-nodeType=DATANODE&var-instance=192.168.130.14:9093&from=1711794777702&to=1711795897998
试验结果：毕设文件夹 WALCompression 和 Baseline 比较

# Records 转 Tablets
|| 吞吐 | 平均延迟 | P25 延迟 | 中位数延迟 | P75 延迟 | P99 延迟 | 最大延迟 | 服务器延迟 | 网络流量 | 磁盘利用率 | 磁盘吞吐  | CPU 利用率 | GC 百分比 |
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
| 1D Tablets| 3862844.76 | 122.68 | 93.60 | 102.32 | 107.29 | 868.15 | 6495.88 | 8.24 ms | 110 MiB/s |  92.7% | 136 MB/s |15.0% |4.88%|
| 1D Records | 2144871.13 | 211.51 | 85.88 | 153.13 | 195.43 | 1422.55 | 7693.99 | 94.3 ms | 96.4 MiB/s | 92.2%|130 MB/s |36.0%|5.42%|
| 2D Tablets | 3739032.71 | 127.78 | 92.29 | 105.15 | 111.70 | 977.38 | 5500.66 | 19.0 | 104 MiB/s | 93.5% | 142 MB/s | 17.5% | 5.05%|
| 2D Records | 1634804.43 | 284.41 | 100.43 | 168.77 | 309.13 | 1797.91 | 9509.75 | 166 ms | 67.1 MiB/s | 93.5% | 95.9 MB/s | 21.6 % | 3.88%|
| 4D Tablets | 3407405.37 | 139.79 | 82.68  | 104.69 | 112.93 | 1208.56 | 14918.80 | 23.7ms | 101 MiB/s | 96.4% | 156 MB/s | 18.6% | 5.90% |
| 4D Records | 1889268.59 | 256.42 | 119.55 | 167.14 | 206.44 | 2598.22 | 15082.84 | 124 ms | 89.9 MiB/s | 94.3% | 140 MB/s | 32.1% | 5.45% |
| 20D Tablets | 2500890.56 | 194.24 | 85.75 | 107.36 | 121.66 | 1966.21 | 21556.98 | 102 ms | 69.1 MiB/s | 96.5% | 141 MB/s | 19.4% | 8.39%|
| 20D Records | 1790860.15 | 274.55 | 131.85 | 176.39 | 245.13 | 2227.98 | 9824.49 | 110ms | 75.9MiB/s | 94.5% | 141 MB/s | 29.4% | 6.38%|
| 40D Tablets | 2397699.15 | 202.88 | 87.90 | 108.61 | 126.46 | 2071.03 | 21469.89 | 115ms | 66.0 MiB/s | 95.6% | 139 MB/s | 24.1% | 9.95% |
| 40D Records | 1855192.51 | 265.88 | 134.81 | 176.74 | 240.38 | 2207.60 | 10502.46 | 139 ms | 77.8 MiB/s | 94.5% | 146 MB/s | 32.4% | 7.83% |
| 100D Tablets | 2449163.17 | 199.65 | 86.20 | 111.18 | 129.65 | 2080.47 | 18176.18 | 96.9 ms | 68.7 MiB/s | 95.1% | 148 MB/s | 29.8% | 11.9% |
| 100D Records |1830864.43 | 269.85 | 136.27 | 177.45 | 242.10 | 2206.78 | 10941.03 | 124 ms | 75.8 MiB/s | 94.0% | 142 MB/s | 32.6% | 8.09%|
|200D Tablets | 2132505.41 | 229.99 | 87.35 | 117.53 | 137.17 | 2622.35 | 13159.35 | 122ms | 61.1 MiB/s | 95.0% | 134 MB/s | 31.8% | 11.4% | 
|200D Records | 1839910.25 | 269.22 | 138.00 | 178.03 | 233.04 | 2179.58 | 9303.81 | 113ms | 77.2MB/s | 93.5% | 145 MB/s | 35.1% | 8.53% | 
| 400D Tablets | 2167443.93 | 227.13 | 91.53 | 127.24 | 150.43 | 2479.96 | 14639.71| 116 ms | 69.2MB/s | 95.3% | 152 MB/s | 38.0%| 12.7%|
|400D Records | 1555690.24 | 318.09 | 121.25 | 180.85 | 325.62 | 2574.37 |15048.78 | 184 ms | 63.1MiB/s | 93.7% | 119 MB/s | 28.2% | 7.16% | 
|1000D Tablets | 1972713.76 | 250.24 | 105.26 | 149.62 | 185.24 | 2466.06 | 14871.22 | 73.4 MB/s | 94.6% | 150MB/s | 49.1% | 14.1%|
|1000D Records|  1445930.22 | 342.69 | 108.12 | 175.63 | 333.99 | 3265.72 | 18682.98 | 212 ms | 60.0 MB/s | 93.7% | 113 MB/s | 29.4%| 6.99%|